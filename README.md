# Ссылка на приложение

https://49fwyfcjqvayz33uxqr8qe.streamlit.app/

# Отчет о выполнении Домашнего задания №1: Предсказание стоимости автомобилей

## 1. Что было сделано

В рамках работы над проектом был пройден полный цикл разработки ML-решения: от анализа данных до деплоя веб-сервиса.

### Этапы работы:

1. **EDA (Разведочный анализ данных):**
* Проведена очистка данных: удаление дубликатов, обработка пропусков (заполнение медианами).
* **Feature Extraction:** Извлечены числовые значения из строковых признаков (`mileage`, `engine`, `max_power`). Написан сложный парсер для признака `torque`, учитывающий разные единицы измерения (Nm vs kgm) и обороты.
* Визуализация распределений и корреляций (Pearson, Phik) для выявления зависимостей и мультиколлинеарности.


2. **Базовое моделирование:**
* Обучена линейная регрессия (`LinearRegression`) на вещественных признаках.
* Применена стандартизация данных (`StandardScaler`).


3. **Регуляризация:**
* Исследованы Lasso (L1), Ridge (L2) и ElasticNet. Подбраны оптимальные гиперпараметры через `GridSearchCV`.
* Реализован кастомный класс **L0-регуляризации** для жесткого отбора признаков.


4. **Feature Engineering (Pro):**
* Добавлены категориальные признаки через One-Hot Encoding (бренд, топливо, владелец и др.).
* Сгенерированы новые признаки: `age` (возраст), `km_per_year` (интенсивность), `power_per_liter` (эффективность двигателя).
* Применено **логарифмирование целевой переменной** (`log1p`), что позволило сгладить асимметрию распределения цен.


5. **Разработка сервиса:**
* Создано веб-приложение на `Streamlit` с возможностью ручного ввода параметров и пакетной обработки CSV-файлов.



---

## 2. Результаты и метрики

В ходе экспериментов качество модели значительно выросло. Основной метрикой был выбрана  (коэффициент детерминации) и MAPE (средняя абсолютная процентная ошибка).

| Этап |  (Test) | Комментарий |
| --- | --- | --- |
| Базовая LinReg (только числа) | **0.59** | Модель недообучена, не хватает информации о бренде и типе авто. |
| LinReg + Scaling | **0.59** | Масштабирование важно для весов, но не меняет качество обычной OLS. |
| Лучшая Lasso/ElasticNet | **0.59** | Регуляризация не дала прироста, так как переобучения изначально не было. |
| **Ridge + Categorical (OHE)** | **~0.78** | Резкий скачок качества за счет добавления брендов и типов кузова. |
| **Feature Eng + Log Target** | **>0.85** | **Итоговая модель.** Логарифмирование цены и новые фичи дали лучший результат. |

### Интерпретация:

Модель успешно объясняет более **85%** вариации цены на тестовой выборке. Средняя ошибка (MAPE) составляет около **10-15%**, что является приемлемым показателем для массового сегмента автомобилей.

---

## 3. Что дало наибольший прирост качества?

1. **Категориальные признаки (One-Hot Encoding):** Самый значимый вклад. Информация о бренде (Maruti vs BMW) и коробке передач (Automatic vs Manual) является критической для ценообразования.
2. **Логарифмирование таргета:** Цены имеют "длинный хвост" (распределение скошено вправо). Обучение на `log(price)` позволило линейной модели лучше работать с дорогими авто и не уходить в отрицательные предсказания.
3. **Создание признака `age`:** Замена года выпуска на возраст авто сделала зависимость более линейной и интерпретируемой.

---

## 4. Что сделать не удалось и почему?

* **Идеально распарсить `torque`:** Признак очень "грязный". Несмотря на RegEx-парсинг, часть данных пришлось заполнять медианами или заглушками, так как формат записи был слишком хаотичным.
* **Победить мультиколлинеарность:** Признаки `engine`, `max_power` и `torque` сильно коррелируют. L1-регуляризация (Lasso) пыталась занулить часть из них, но это приводило к падению метрики. Было решено оставить Ridge, который "размазывает" веса, но сохраняет информацию.
* **Предсказание редких элитных авто:** Модель ошибается на эксклюзивных машинах (раритеты, суперкары), так как их слишком мало в обучающей выборке. Это классическая проблема выбросов.

---

## 5. Оценка разработанного сервиса (Streamlit)

### Удобство использования

Приложение получилось интуитивно понятным.

* **Плюсы:** Разделение на вкладки (EDA / Предсказание / Анализ весов) не перегружает интерфейс. Наличие двух режимов ввода (поштучно и файлом) закрывает потребности как обычного пользователя, так и аналитика.
* **UX:** Использование выпадающих списков (`selectbox`) вместо ручного ввода текста защищает от опечаток.

### Визуализация

* **Удачно:** График **Feature Importance** (веса модели). Он повышает доверие пользователя, показывая, *почему* цена именно такая (например, "цена выросла, потому что год 2020").
* **Менее удачно:** EDA-блок статичен. В идеале хотелось бы добавить интерактивные фильтры (например, посмотреть распределение цен только для BMW), но в текущей версии графики построены на всем датасете.

### Ограничения и проблемы

1. **Cold Start:** Если пользователь введет бренд авто, которого не было в `train` (например, *Tesla*), One-Hot Encoding в приложении создаст колонки, отличные от тех, что ждет модель. *Решение:* реализовано выравнивание колонок через `.reindex`, но предсказание для неизвестных брендов будет смещено (они будут считаться "средней машиной").
2. **Размер файлов:** Модель и скейлер хранятся в `.pkl`, но при усложнении модели (например, CatBoost) размер может стать проблемой для деплоя на бесплатные хостинги.

### План улучшений (Next Steps)

1. Заменить `Ridge` на градиентный бустинг (`CatBoost` или `XGBoost`), который лучше работает с категориями и нелинейностями.
2. Добавить парсинг курса валют для отображения цены в разных валютах.
3. Реализовать валидацию загружаемого CSV-файла (проверка на наличие всех необходимых колонок перед предсказанием).